<!-- TOC -->

- [1. 存储管理](#1-存储管理)
    - [1.1. 一种存储器抽象：地址空间](#11-一种存储器抽象地址空间)
        - [1.1.1. 地址空间的概念](#111-地址空间的概念)
        - [1.1.2. 交换技术](#112-交换技术)
        - [1.1.3. 空闲内存管理](#113-空闲内存管理)
    - [1.2. 虚拟内存](#12-虚拟内存)
        - [1.2.1. 分页](#121-分页)
        - [1.2.2. 页表](#122-页表)
    - [1.3. 页面置换算法](#13-页面置换算法)
        - [1.3.1. 最优页面置换算法](#131-最优页面置换算法)
        - [1.3.2. 最近未使用页面置换算法NCU](#132-最近未使用页面置换算法ncu)
        - [1.3.3. 先进先出FIFO](#133-先进先出fifo)
        - [1.3.4. 第二次机会](#134-第二次机会)
        - [1.3.5. 时钟页面置换算法](#135-时钟页面置换算法)
        - [1.3.6. 最近最少使用LRU](#136-最近最少使用lru)
        - [1.3.7. 工作集时钟](#137-工作集时钟)

<!-- /TOC -->
# 1. 存储管理

操作系统中管理分层存储器体系的部分称为存储管理器。

## 1.1. 一种存储器抽象：地址空间

### 1.1.1. 地址空间的概念

每个内存在送到内存之前，都会加上==基址寄存器==的内容，界限寄存器检查是否出界。

每次都需要加法和比较，耗时。

### 1.1.2. 交换技术

交换技术：把一个进程完整调入内存，运行一段时间后再存回磁盘。

### 1.1.3. 空闲内存管理

1. 使用位图，查找耗时

2. 链表，分配算法：

	首次适配算法：沿链表找到第一个足够大的空闲区。

	下次适配算法：从上次找到的位置向后查询新的内存区。比首次试配性能略低。

	最佳适配：搜索整个链表，找到容纳进程的最小空闲区。比前两个慢而且浪费内存。

	最差适配：总是分配最大的空闲区。

	快速适配：维护一个空闲区信息的链表。

## 1.2. 虚拟内存

### 1.2.1. 分页

适用于虚拟内存大而实际物理内存小的情况。

由程序产生的地址为**虚拟地址**，构成虚拟地址空间。

虚拟地址送到MMU（内存关系单元），MMU把虚拟地址映射为物理地址。

![1584755564403](https://i.loli.net/2020/03/22/9yCYB1jN7tVeMxW.png)

虚拟地址空间按照固定大小划分为**页面**的若干单元。在物理内存称为**页框**。页面和页框的大小通常是一致的。

当虚拟页面没有页框映射，会产生**==缺页异常==**。

![1584755776100](https://i.loli.net/2020/03/22/TzhpaYK5vVyJuXj.png)

### 1.2.2. 页表

虚拟地址到物理地址的映射可以概括为：虚拟地址被分为虚拟页号（高位部分）和偏移量（低位部分）两部分。对于16位地址和4KB的页面大小，高四位可以指定16个虚拟页面中的一页，低12位确定了业内的偏移量。

使用页表就是把虚拟页面映射到页框中。

![1584755964574](https://i.loli.net/2020/03/22/dHSsmozgDqaEefM.png)

## 1.3. 页面置换算法

### 1.3.1. 最优页面置换算法

无法实现，只能作为标准。

### 1.3.2. 最近未使用页面置换算法NCU

当缺页异常时，页框中的页面通过读位R和修改位M，可以分为：

| 第0类 | 没有被访问 | 没有被修改 |
| ----- | ---------- | ---------- |
| 第1类 | 没有被访问 | 被修改     |
| 第2类 | 已被访问   | 没有被修改 |
| 第3类 | 已被访问   | 已被修改   |

选取编号最小的置换出来。

### 1.3.3. 先进先出FIFO

把链表头置换出去

### 1.3.4. 第二次机会

依次遍历队列头，如果R为1，把R清零放到队列尾，否则置换出去。

### 1.3.5. 时钟页面置换算法

环形链表，如果R是0就淘汰，否则清除R位并判断下一个。

### 1.3.6. 最近最少使用LRU

### 1.3.7. 工作集时钟

环形链表，如果R是1就清除R位并判断下一个。

如果R=0，如果生存时间大于$$\tau$$，把页面放在该页框中。

