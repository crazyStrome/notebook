[TOC]

#  配置及相关

##  启动Redis Server

- 默认配置启动redis-server
- 运行启动，在后面添加启动参数`redis-server --port 6380`
- 配置文件启动`redis-server /opt/redis/redis.conf`

---

##  启动Redis客户端

- 使用交互方式：`redis-cli-h{host}-p{port}`
- 使用命令方式：`redis-cli-h ip{host}-p{port}{command}`

---

###  全局命令

一些通用的命令

- 查看所有键：`keys *`
- 键总数：`dbsize`，dbsize在计算总键数不会遍历所有键，而是直接获取Redis内置的键总数变量，所以dbsize的时间复杂度是o(1)。而keys命令会遍历所有键，所以它的时间复杂度为o(n)，当redis保存了大量键时，线上环境禁止使用keys。
- 检查键是否存在：`exists key`，如果存在则返回1，不存在返回0。
- 删除键：`del key [key…]`，del是个通用命令，无论值是什么数据结构类型，del命令都可以将其删除。返回结果为成功删除键的个数。
- 键过期：`expire key seconds`，Redis支持对键添加过期时间，当超过过期时间后，会自动删除键。
- 键的剩余时间：`ttl key`，返回值为大于等于0的整数是键的剩余过期时间；-1表示键没有设置过期时间；-2表示键不存在。
- 键的数据结构类型：`type key`

---

###   数据结构和内部编码

每种数据结构都有自己底层的内部编码实现，而且是多种实现，Redis会在合适的场景选择合适的内部编码。如图2.2所示。

![计算机生成了可选文字: key 图2．2 数掂佶构 hash lish Set Re山s数据结构和内部编码 内鄶偏码 Int embstr hashtablc ZIP11St linkedlist hashtable mtset sk甲依t ZIPhst](https://i.loli.net/2020/03/22/KDqxpStOCrbYIM4.png)

- 查询内部编码：`object encoding key`

Redis这样设计好处：第一，可以改进内部编码而对外的数据结构和命令没有影响，这样一旦开发出更优秀的内部编码，无需改动外部数据结构和命令。第二，多种内部编码实现可以在不同场景下发挥各自的优势，比如ziplist比较节省内存，但是在列表元素比较多的情况下，性能可能会有所下降，所以可以使用linkedlist。

---

###  单线程架构

Redis 使用了单线程架构和I/O多路复用模型来实现高性能的内存数据库服务。

如图所示为客户端和服务器的模型。

 

![计算机生成了可选文字: Client 图2一3 1.送命令 2．执行命令 网络 Redis 3，返回秸果 Redis客户端与服务端请求过程](https://i.loli.net/2020/03/22/tP2ZYDOsez9i7dH.png)

第二步中，因为Redis是单线程处理命令的，所以一条命令从客户端到达服务端不会立刻执行，所有命令都会进入一个队列中，然后逐个执行。

Radis使用单线程还特别快的原因：

- 纯内存访问，Redis将所有数据放在内存中，内存的相应时间长达约为100纳秒，这是Redis达到每秒万级别访问的重要基础。
- 非阻塞IO，Redis使用epoll作为IO多路复用计数的实现，再加上Redis自身的事件处理模型将epoll中的连接、读写、关闭都转换为事件，不在网络IO上浪费过多的事件。
- 单线程避免线程切换和竟态产生的损耗。

单线程的好处：

- 简化数据结构和算法的实现。
- 避免线程切换和竞争产生额损耗。

单线程的问题：

- 对于每个命令的执行是有要求的，如果某个命令执行过长，则会造成其他命令阻塞。